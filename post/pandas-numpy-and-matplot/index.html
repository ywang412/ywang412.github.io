<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pandas, Numpy and Matplot | Yu&#39;s Github</title>
<link rel="shortcut icon" href="https://ywang412.github.io/favicon.ico?v=1579558965678">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://ywang412.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-143424668-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-143424668-1');
</script>


  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://ywang412.github.io">
  <img class="avatar" src="https://ywang412.github.io/images/avatar.png?v=1579558965678" alt="">
  </a>
  <h1 class="site-title">
    Yu&#39;s Github
  </h1>
  <p class="site-description">
    Java, SQL, Python and a little bit of Scala 
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          Home
        </a>
      
    
      
        <a href="/archives" class="menu">
          Archive
        </a>
      
    
      
        <a href="/tags" class="menu">
          Tag
        </a>
      
    
      
        <a href="/post/resume" class="menu">
          Resume
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>


        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Pandas, Numpy and Matplot
            </h2>
            <div class="post-info">
              <time class="post-time">
                · 2018-09-15 ·
              </time>
              
                <a href="https://ywang412.github.io/tag/GnJOCYZZE" class="post-tag">
                  # Python
                </a>
              
            </div>
            
            <div class="post-content">
              <p><strong>Numpy</strong></p>
<p>To be able to operate on two np arrays, from the last axis to first axis the length should match or one of them should be one.</p>
<pre><code>arrA = np.array([[0., 0., 0.], [1., 1., 1.], [2., 2., 2.], [3., 3., 3.]])
arrB = np.array([1., 2., 3.])
arrA+arrB

a = np.array([1, 2, 3, 4])
b = np.array([True, True, False, False])
print(a[b])
print(a[a&gt;2])
[1 2]
[3 4]

a = np.array([1,2,3,4])

# take a slice, numpy doesn't create a new array. 
Slice = a[:3]
Slice[0] = 10
print(a)

# try python list
a = [1,2,3,4]
Slice = a[:3]
Slice[0] = 10
print(a)
[10  2  3  4]
[1, 2, 3, 4]
</code></pre>
<pre><code>data = np.random.randn(3, 4)
[[ 0.81516464  0.54699707  0.25469129 -0.35725194]
 [-0.1594436   0.47096122 -0.51086806 -0.82336626]
 [-0.76274312  0.66010544  0.45585599  0.80401797]]
data[[True, False, False],1]
[ 0.54699707]
data[data &lt; 0]
[-0.35725194 -0.1594436  -0.51086806 -0.82336626 -0.76274312] 
</code></pre>
<p><strong>Pandas Series</strong></p>
<pre><code>s = pd.Series([-1.55666192,-0.75414753,0.47251231,-1.37775038,-1.64899442], index=['a', 'b', 'c', 'd', 'e'],dtype='int8' )
s = pd.Series(np.random.randn(5), index=['a', 'b', 'c', 'd', 'e'])
s = pd.Series({'a' : 0., 'b' : 1., 'c' : 2.},index=['b', 'c', 'd', 'a'])
b    1.0
c    2.0
d    NaN
a    0.0

#visit
s[['a','b','c']]
s[:2]
</code></pre>
<p><strong>Pandas dataframe</strong></p>
<pre><code>df = pd.DataFrame({'one': [1., 2., 3., 5], 'two': [1., 2., 3., 4.]})
   one  two
0  1.0  1.0
1  2.0  2.0
2  3.0  3.0
3  5.0  4.0
df = pd.DataFrame([[1., 2., 3., 5],[1., 2., 3., 4.]],index=['a', 'b'],columns=['one','two','three','four'])
   one  two  three  four
a  1.0  2.0    3.0   5.0
b  1.0  2.0    3.0   4.0

data = np.zeros((2,), dtype=[('A', 'i4'),('B', 'f4'),('C', 'a10')])
[(0,  0., '') (0,  0., '')]
data[:] = [(1,2.,'Hello'), (2,3.,&quot;World&quot;)] 
df = pd.DataFrame(data, index=['first', 'second'])
         A    B      C
first   1  2.0  Hello
second  2  3.0  World
data = {'one' : pd.Series([1., 2., 3.], index=['a', 'b', 'c']),
        'two' : pd.Series([1., 2., 3., 4.], index=['a', 'b', 'c', 'd'])}
   one  two
a  1.0  1.0
b  2.0  2.0
c  3.0  3.0
d  NaN  4.0
data2 = [{'a': 1, 'b': 2}, {'a': 5, 'b': 10, 'c': 20}]
df = pd.DataFrame(data2)
   a   b     c
0  1   2   NaN
1  5  10  20.0
 
# visit  
df['one']
df.one

#visit row
df[0:1]

# loc using label
df.loc['a']    # get a row
df.loc[:,['one','two'] ]    # get all rows for two columns
df.loc[['a',],['one','two']]

#iloc using index
df.iloc[0:2,0:1]
df.iloc[[0,2],[0,1]]

# read csv via pandas
data = pd.read_csv('gdp_per_capita.csv')

# check the unique items in a column
len(data['Country'].unique())


# applymap()
df = pd.DataFrame({
        'a': [1, 2, 3],
        'b': [10, 20, 30],
        'c': [5, 10, 15]
    })
def add_one(x):
        return x + 1
print(df.applymap(add_one))
   a   b   c
0  2  11   6
1  3  21  11
2  4  31  16


# use apply() to compute standarized value of each element
def standardize(df):
    return df.apply(lambda x: (x-x.mean())/x.std(ddof = 0))
print(standardize(grades_df))
# case 2 of apply()
df = pd.DataFrame({
    'a': [4, 5, 3, 1, 2],
    'b': [20, 10, 40, 50, 30],
    'c': [25, 20, 5, 15, 10]
})
print(df.apply(np.max))


def standardize(df): 
    return (df - df.mean())/df.std(ddof=0)

def standardize_rows(df): 
    mean = df.mean(axis='columns')
    std = df.std(ddof=0, axis='columns')
    return df.add(-mean, axis='index').div(std, axis='index')   # note .div() is similar to .add()

print(standardize(grades_df))
print(standardize_rows(grades_df))

# show how .add() works
t= grades_df.add(-grades_df.mean(axis='columns'), axis='index') # .add(negative) is the same as .sub(positive)
print(t)

# show how .div() works
print(t.div(grades_df.std(ddof=0, axis='columns'), axis='index'))

values = np.array([1, 3, 2, 4, 1, 6, 4])
example_df = pd.DataFrame({
    'value': values,
    'even': values % 2 == 0,
    'above_three': values &gt; 3 
}, index=['a', 'b', 'c', 'd', 'e', 'f', 'g'])
example_df

# get sum of each group
print(example_df.groupby(['even']).sum())
 
</code></pre>
<p><strong>CSV</strong></p>
<pre><code>df_csvload  =  pd.read_csv('C:\\Users\\Administrator\\Desktop\\table.csv',parse_dates=True,index_col=0,encoding='gb2312')
df_adddat = pd.DataFrame([{u'Open':1.1, u'High':1.2, u'Low':1.3, u'Close':1.4}, {u'Open':2.1, u'High':2.2, u'Low':2.3, u'Close':2.4}],index=[datetime.datetime.strptime(&quot;2016-06-25 00:00:00&quot;, &quot;%Y-%m-%d %H:%M:%S&quot;),datetime.datetime.strptime(&quot;2016-06-26 00:00:00&quot;, &quot;%Y-%m-%d %H:%M:%S&quot;)])
df_csvload = df_csvload.append(df_adddat)
df_csvload.to_csv('C:\\Users\\Administrator\\Desktop\\table-add.csv', columns=df_csvload.columns, index=True) 
</code></pre>
<p><strong>Pandas data cleaning</strong></p>
<pre><code>
print(u&quot;**********************************1.1、数据信息查看*********************************************************&quot;)

#加载csv文件数据
df_csvload  = pd.read_csv('C:\\Users\\Administrator\\Desktop\\table.csv',parse_dates=True,index_col=0,encoding='gb2312')

print(df_csvload.head())#查看前几行   
print(df_csvload.tail())#查看后几行
print(df_csvload.columns)#查看列名
print(df_csvload.index)#查看索引
print(df_csvload.shape)#查看形状

print(df_csvload.describe())#查看各列数据描述性统计
print(df_csvload.info())#查看缺失及每列数据类型 事先去除数值
print(u&quot;**********************************1.2、缺失值处理*********************************************************&quot;)

print(df_csvload.isnull())#判断数据缺失值
print(df_csvload[df_csvload.isnull().T.any().T])#查看NAN值所在行
#只要有一个缺失值就删除该行
#df_csvload = df_csvload.dropna(axis=0,how='any')#NAN值删除 
#print(df_csvload)
df_csvload = df_csvload.dropna(axis=0,how='all')#NAN值删除 所有值都为缺失值时才删除该行
df_csvload.fillna(method='bfill',axis=0,inplace=True)#NAN值填充 列方向前值填充
print(df_csvload[df_csvload.isnull().values==True])#查看NAN值删除填充后值

print(u&quot;**********************************1.3、特殊值处理*********************************************************&quot;)

#df_csvload = df_csvload.applymap(lambda x:'%0.2f'%x)#保留2位小数
#print(df_csvload)
#print(df_csvload.info())
df_csvload = df_csvload.round(2)#保留2位小数
print(df_csvload)
print(df_csvload.info())
print(df_csvload[df_csvload.values==0])#查看df_csvload数据中所有0值的元素
df_csvload.loc[df_csvload.loc[:,'Low']==0,'Low'] = df_csvload.Low.median()#
print(df_csvload.loc['2018-01-15'])

print(u&quot;**********************************1.4、数据运算转化*********************************************************&quot;)

#数据运算
change = df_csvload.High - df_csvload.Low#最高价-最低价
df_csvload['pct_change'] = (change / df_csvload['Close'].shift(1)) #/昨收
print(df_csvload)
df_csvload['pct_change'].fillna(df_csvload['pct_change'].mean(),inplace=True) #序列第一个值Na
print(df_csvload)

print(u&quot;**********************************1.5、数据合并及连接*********************************************************&quot;)

#数据合并
dfv_csvload  = pd.read_csv('C:\\Users\\Administrator\\Desktop\\table-Volume.csv',parse_dates=True,index_col=0,encoding='gb2312')
df_concat =pd.concat([df_csvload, dfv_csvload],axis=1,keys=['Price','amount'])
print(df_concat)
</code></pre>
<p><strong>Pandas data scanning</strong></p>
<pre><code>print(u&quot;**********************************1.for..in循环迭代方式*********************************************************&quot;)

 
&quot;&quot;&quot;
#迭代循环测试
x = [1,2,3]
its = x.__iter__() #列表是可迭代对象，否则会提示不是迭代对象
print(its)
#&lt;list_iterator object at 0x100f32198&gt;
print(next(its)) # its包含此方法，说明its是迭代器
#1
print(next(its)) 
#2
print(next(its)) 
#3
print(next(its)) 
&quot;&quot;&quot;
&quot;&quot;&quot; 
#生成器测试
def gensquares(N):
	for i in range(N):
		yield i**2 
print(gensquares(5))
for i in gensquares(5):
	print(i) 

print(x**2 for x in range(5))
print(list(x**2 for x in range(5)))

#&lt;generator object &lt;genexpr&gt; at 0xb3d31fa4&gt;
#[0, 1, 4, 9, 16]
&quot;&quot;&quot;
 
from timeit import timeit 
def iterator_looping(df):
    disftance_list = []
    for i in range(0,len(df)):
        disftance_list.append(df.iloc[i]['Open']-df.iloc[i]['Close'])
    return disftance_list

print(iterator_looping(df_csvload))

disftance_list = [(df_csvload.iloc[i]['Open']-df_csvload.iloc[i]['Close']) for i in range(0,len(df_csvload))]
print(disftance_list)

def iterrows_loopiter(df):
    disftance_list = []
    for index,row in df.iterrows():
        disftance_list.append(row['Open']-row['Close'])
    return disftance_list
print(iterrows_loopiter(df_csvload))    
    
    
disftance_list = df_csvload.apply(lambda row: (row['Open']-row['Close']), axis =1)
print(disftance_list)

df_csvload['rate'] = df_csvload['Open']-df_csvload['Close']
print(df_csvload['rate'])

df_csvload['rate'] = df_csvload['Open'].values-df_csvload['Close'].values 
print(df_csvload['rate'])

def test1():
    iterator_looping(df_csvload)
def test2():
    iterrows_loopiter(df_csvload)   
def test3():
    disftance_list = df_csvload.apply(lambda row: (row['Open']-row['Close']), axis =1)
def test4():
    df_csvload['rate'] = df_csvload['Open']-df_csvload['Close']
def test5():
    df_csvload['rate'] = df_csvload['Open'].values-df_csvload['Close'].values 

#for..in循环迭代方式
t1 = timeit('test1()', 'from __main__ import test1', number=1000)
#iterrows()遍历方式
t2 = timeit('test2()', 'from __main__ import test2', number=1000)
#apply()方法循环方式
t3 = timeit('test3()', 'from __main__ import test3', number=1000)
#Pandas series 的矢量化方式
t4 = timeit('test4()', 'from __main__ import test4', number=1000)
#Numpy arrays的矢量化方式：
t5 = timeit('test5()', 'from __main__ import test5', number=1000)

print(t1,t2,t3,t4,t5)

</code></pre>
<figure data-type="image" tabindex="1"><img src="https://ywang412.github.io/post-images/1573343310831.png" alt=""></figure>
<p><strong>astype vs to_numeric</strong></p>
<pre><code># convert Series
my_series = pd.to_numeric(my_series)

# convert column &quot;a&quot; of a DataFrame
df[&quot;a&quot;] = pd.to_numeric(df[&quot;a&quot;])

# convert all columns of DataFrame
df = df.apply(pd.to_numeric) # convert all columns of DataFrame

# convert just columns &quot;a&quot; and &quot;b&quot;
df[[&quot;a&quot;, &quot;b&quot;]] = df[[&quot;a&quot;, &quot;b&quot;]].apply(pd.to_numeric)

# convert all DataFrame columns to the int64 dtype
df = df.astype(int)

# convert column &quot;a&quot; to int64 dtype and &quot;b&quot; to complex type
df = df.astype({&quot;a&quot;: int, &quot;b&quot;: complex})

# convert Series to float16 type
s = s.astype(np.float16)

# convert Series to Python strings
s = s.astype(str)

# convert Series to categorical type - see docs for more details
s = s.astype('category')
</code></pre>
<p><strong>Matplot</strong></p>
<pre><code>import numpy as np
import matplotlib
import matplotlib.pyplot as plt#(1)
from matplotlib.figure import Figure

plt.rcParams['font.sans-serif']=['SimHei'] #用来正常显示中文标签
plt.rcParams['axes.unicode_minus']=False #用来正常显示负号

#基础数据
y_value = np.random.randn(200)
x_value = np.arange(200)

ylim_min = y_value.min()-1
ylim_max = y_value.max()+1

yticks_min = y_value.min()+0.5
yticks_max = y_value.max()-0.5
ylim_setp = (yticks_max - yticks_min)/2.1
#基础数据
&quot;&quot;&quot;
#函数式编程
plt.xlim(0,len(x_value))#注释(2)
plt.ylim(ylim_min,ylim_max)#注释(2)
plt.xticks(np.arange(0,len(x_value),20),['2015-02-01','2015-03-01','2015-04-02','2015-05-02','2015-06-02','2015-07-02','2015-08-02','2015-09-02','2015-10-02','2015-11-02'],rotation=45)#注释(3)
plt.yticks(np.arange(yticks_min,yticks_max,ylim_setp),[u'上限预警值',u'标准值',u'下限预警值'])#注释(3)
plt.title(u&quot;函数式编程&quot;)#注释(4)
plt.xlabel(u&quot;日期&quot;)#注释(5):
plt.ylabel(u&quot;数值&quot;)  #注释(5):
plt.grid(True)#注释(6)
plt.legend(loc='best')#注释(7)
plt.plot(x_value,y_value,label=u&quot;随机误差&quot;,ls='-',c='r',lw=1) #注释(8) 
plt.show()  
#函数式编程
&quot;&quot;&quot;

''' 对象式编程 '''
&quot;&quot;&quot;
fig = plt.figure()
#ax1 = fig.add_subplot(211)
ax1 = fig.add_axes([0.1, 0.1, 0.4, 0.3])
ax1.plot(x_value,y_value,label=u&quot;随机误差&quot;,ls='-',c='r',lw=1)  
ax1.set_xlim(0,len(x_value))#调节X轴范围
ax1.set_ylim(ylim_min,ylim_max)#调节Y轴范围
ax1.set_xticks(np.arange(0,len(x_value),20))
ax1.set_yticks(np.arange(yticks_min,yticks_max,ylim_setp))
ax1.set_xticklabels(['2015-02-01','2015-03-01','2015-04-02','2015-05-02','2015-06-02','2015-07-02','2015-08-02','2015-09-02','2015-10-02','2015-11-02'],fontsize='small')
ax1.set_yticklabels([u'上限预警值',u'标准值',u'下限预警值'])
ax1.set_title(u&quot;对象式编程子图1&quot;)
ax1.set_xlabel(u&quot;日期&quot;)
ax1.set_ylabel(u&quot;数值&quot;)
#ax2 = fig.add_subplot(212)
ax2 = fig.add_axes([0.5, 0.5, 0.4, 0.3])
ax2.plot(x_value,y_value,label=u&quot;随机误差&quot;,ls='-',c='y',lw=1)      
ax2.set_xlim(0,len(x_value))#调节X轴范围
ax2.set_ylim(ylim_min,ylim_max)#调节Y轴范围
ax2.set_xticks(np.arange(0,len(x_value),20))
ax2.set_yticks(np.arange(yticks_min,yticks_max,ylim_setp))
ax2.set_xticklabels(['2015-02-01','2015-03-01','2015-04-02','2015-05-02','2015-06-02','2015-07-02','2015-08-02','2015-09-02','2015-10-02','2015-11-02'],rotation=45,fontsize='small')
ax2.set_yticklabels([u'上限预警值',u'标准值',u'下限预警值'])
ax2.set_title(u&quot;对象式编程子图2&quot;)
ax2.set_xlabel(u&quot;日期&quot;)
ax2.set_ylabel(u&quot;数值&quot;)
plt.show()
&quot;&quot;&quot;
''' 对象式编程 '''


&quot;&quot;&quot; subplots 遍历显示图形&quot;&quot;&quot;
&quot;&quot;&quot;
fig_ps,axes_ps = plt.subplots(2,3)
print(axes_ps)
for i in range(2):
    for j in range(3):
        axes_ps[i,j].hist(np.random.randn(500),bins=50,color='k',alpha=0.5)
plt.show()
&quot;&quot;&quot;
&quot;&quot;&quot; subplots 遍历显示图形&quot;&quot;&quot;
&quot;&quot;&quot; Artist 对象测试&quot;&quot;&quot;

fig = plt.figure()
ax = fig.add_subplot(111)
line = ax.plot(x_value,y_value,label=u&quot;随机误差&quot;,ls='-',c='r',lw=1)  
print(&quot;line&quot;,line)
print(&quot;ax.line&quot;,ax.lines)

plt.show()
&quot;&quot;&quot;
</code></pre>

            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://ywang412.github.io/post/python-3-quick-start-2-pep8">
              <h3 class="post-title">
                Python 3 quick start - 2 PEP8
              </h3>
            </a>
          </div>
        

        
          

          
            <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css">
<script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>

<div id="disqus_thread"></div>

<script>

var options = {
  shortname: 'ywang412',
  apikey: 'gmr5wORrpUmczJ0fs6x1CjNX2WgIP2riU2sSqLrIo6Idh3GkyiY8WIpUwBaP70X5',
}
if ('') {
  options.api = ''
}
var dsqjs = new DisqusJS(options)

</script>

          
        

        <div class="site-footer">
   | 
  <a class="rss" href="https://ywang412.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
