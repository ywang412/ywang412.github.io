<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>SQL 2 - Index | Yu&#39;s Github</title>
<meta name="description" content="Java by day, Scala by night">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://ywang412.github.io/favicon.ico?v=1572585253566">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://ywang412.github.io/styles/main.css">


  

  
    <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css" />
  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-143424668-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-143424668-1');
</script>


  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://ywang412.github.io">
        <img src="https://ywang412.github.io/images/avatar.png?v=1572585253566" class="site-logo">
        <h1 class="site-title">Yu&#39;s Github</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            Home
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            Archive
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            Tag
          </a>
        
      
        
          <a href="/post/resume" class="site-nav">
            Resume
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/ywang412/" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      Java by day, Scala by night
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://ywang412.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">SQL 2 - Index</h2>
            <div class="post-date">2018-11-11</div>
            
            <div class="post-content">
              <p>B tree
<img src="https://ywang412.github.io/post-images/1570566488064.png" alt="">
vs B+ tree
<img src="https://ywang412.github.io/post-images/1570566504268.png" alt=""></p>
<p>Auto increment primary key can prevent breaking the B+ tree.
<img src="https://ywang412.github.io/post-images/1571012532447.png" alt=""></p>
<p>Clustered index - primary key if exist
If no primary key, first not-nullable unique index or rowid.
Only one clustered index and one B+ tree for a table.</p>
<p>Non-clustered index
B+ tree leaf node only have index field and primary key
Search query will find primary key first and then fetch the record, therefore more costly.</p>
<p><strong>Where to have index</strong></p>
<ol>
<li>where clause
<code>select * from t9_1 where d = 90000;</code></li>
<li>aggregate function
<code>select max(d) from t9_1;</code>
<code>select count(*) from t9_1;</code>
because count(*) use non-clustered index (only index and primary key) which is faster than clustered index.</li>
<li>order by</li>
<li>use only non-clustered index
<code>select b,c from t9_1 where b=90000;</code>
use idx_b_c</li>
<li>Join clause
turn BNL to NLJ search</li>
</ol>
<p><strong>Difference between unique index and non-unique index</strong></p>
<p>non-clustered non-unique index use change buffer to combine multiple insert.
Unique index has to load data into memory to check uniqueness.</p>
<p>Although non-unique index will continue after finding the first matching record, it is highly possible that all matching records are loaded into memory in same page. Therefore, search query for unique index and non-unique index are the same.</p>
<p><strong>Multi-column indexes</strong>
<code>select * from t11 where a=1 and b=1 and c=1;</code>  use idx_a_b_c
<code>select * from t11 where c=1 and b=1 and a=1; /* sql2 */</code>  same as first query, order doesn't matter</p>
<p><code>select * from t11 where a=2 and b in (1,2) and c=2; /* sql3 */</code>
<code>select * from t11 where a=1 and b=2 order by c; /* sql4 */</code>
<code>select * from t11 where a=1 order by b,c; /* sql5 */</code>
use idx_a_b_c</p>
<p>idx_a_b_c is equivalent to idx_a, idx_a_b, idx_a_b_c.</p>
<p><code>select * from t11 where a=2 and b in (3,4) order by c; /* sql13 */</code>  will only use idx_a_b
<code>select * from t11 where b=1 and c=1; /* sql34 */</code> cannot use idx_a_b_c</p>
<p><strong>Cardinality</strong>
<code>show index from t13;</code>
Cardinality is the estimate of distinct index values. Query will use index of larger cardinality.</p>
<p>If returned rows number is large, query may use the primary key index to fetch all records. Use force index to force specified index.</p>

            </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://ywang412.github.io/post/sql-optimization">
                  <h3 class="post-title">
                    SQL 1 - Optimization and Best Practice
                  </h3>
                </a>
              </div>
            

            
              

              
                <div id="disqus_thread" data-aos="fade-in"></div>
              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  

  
    <script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>
    <script>

    var options = {
      shortname: 'ywang412',
      apikey: 'gmr5wORrpUmczJ0fs6x1CjNX2WgIP2riU2sSqLrIo6Idh3GkyiY8WIpUwBaP70X5',
    }
    if ('') {
      options.api = ''
    }
    var dsqjs = new DisqusJS(options)

    </script>
  




  </body>
</html>
